<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Accounting Decision Modeler</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for graphing -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#003366',
                        'scope1-color': '#EF4444',
                        'scope2-color': '#F59E0B',
                        'scope3-color': '#10B981',
                        'accuracy-color': '#4C51BF',
                        'control-bg': '#F9FAFB',
                        'missed-red': '#B91C1C',
                        'counted-green': '#065F46',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        .control-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #D1D5DB;
            border-radius: 5px;
            outline: none;
            opacity: 0.9;
            transition: opacity .2s;
        }
        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--slider-thumb-color, #003366);
            cursor: pointer;
            border: 3px solid #fff;
        }
        .control-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--slider-thumb-color, #003366);
            cursor: pointer;
            border: 3px solid #fff;
        }
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .tooltip-container {
            position: relative;
            display: inline-block;
        }
        .tooltip-icon {
            cursor: help;
            color: #6B7280;
            margin-left: 4px;
        }
        .tooltip-text {
            visibility: hidden;
            width: 220px;
            background-color: #374151;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 10;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.4;
        }
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .controls-scroll {
            max-height: calc(100vh - 280px);
            overflow-y: auto;
        }
        .full-width-padded {
            width: 100%;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }
        #breakdownChart {
            width: 100% !important;
            height: 100% !important;
        }
        .uncertainty-badge {
            background-color: #FEF3C7;
            color: #92400E;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-2 md:p-4 font-sans">

    <div id="app" class="full-width-padded space-y-4">
        
        <header class="text-center space-y-1 mb-2 md:mb-4">
            <h1 class="text-2xl md:text-3xl font-bold text-primary-dark">
                Corporate Carbon Report Modeler
            </h1>
            <p class="text-sm md:text-lg text-gray-600">
                Simulate how <strong>IPCC Tier Precision</strong> and <strong>GHG Scope Inclusion</strong> change a company's final reported footprint.
            </p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-3 md:gap-4">

            <!-- Controls Panel -->
            <div class="lg:col-span-1 bg-white p-3 md:p-4 rounded-xl shadow-lg border-t-4 border-primary-dark flex flex-col">
                <h2 class="text-lg md:text-xl font-bold mb-3 text-primary-dark">
                    Accounting Choices
                </h2>
                
                <div id="controls" class="space-y-3 md:space-y-4 controls-scroll">

                    <!-- Industry Selection -->
                    <div class="space-y-1.5">
                        <h3 class="font-bold text-base md:text-lg text-gray-700 border-b pb-1">1. Select Industry Scenario</h3>
                        <select id="industry-selector" class="w-full p-2 text-sm border border-gray-300 rounded-lg focus:ring-primary-dark focus:border-primary-dark transition duration-150">
                            <option value="manufacturing">Heavy Manufacturing</option>
                            <option value="service">Financial Services/Office</option>
                            <option value="tech">Software/Cloud Provider</option>
                            <option value="construction">High-Rise Construction</option>
                            <option value="retail">Food Retail/Grocery</option>
                        </select>
                        <p id="industry-description" class="text-xs text-gray-600 bg-gray-50 p-2 rounded-lg border">
                            This profile is dominated by high Scope 2 (energy) and upstream Scope 3 (raw materials, logistics), typical of large-scale production.
                        </p>
                    </div>

                    <!-- IPCC Tier Precision -->
                    <div class="space-y-1.5">
                        <h3 class="font-bold text-base md:text-lg text-gray-700 border-b pb-1">2. IPCC Tier Precision</h3>
                        <div class="bg-control-bg p-3 rounded-lg shadow-sm">
                            <label for="precision" class="block font-semibold text-base text-accuracy-color mb-1">
                                Scope 1 & 2 Precision (Tier Level)
                                <span class="tooltip-container">
                                    <span class="tooltip-icon" title="?">?</span>
                                    <span class="tooltip-text">
                                        <strong>Tier 1:</strong> Global averages (e.g., IPCC default factors)<br>
                                        <strong>Tier 2:</strong> National/regional factors (e.g., country-specific grid mix)<br>
                                        <strong>Tier 3:</strong> Site-specific data (e.g., continuous stack monitoring).
                                    </span>
                                </span>
                            </label>
                            <input type="range" id="precision" min="0" max="100" value="50" step="1" class="control-slider" style="--slider-thumb-color: #4C51BF;">
                            <div class="flex justify-between text-xs mt-1 text-gray-500">
                                <span>Tier 1 (Estimate)</span>
                                <span>Tier 3 (Specific)</span>
                            </div>
                        </div>
                        <div id="tier-explanation" class="bg-blue-100 border-l-4 border-blue-500 p-2 text-xs text-blue-700 rounded-lg">
                            <h4 class="font-bold inline-block mr-1">Tier 2:</h4> Uses <strong>nationally or regionally specific emission factors</strong>.
                        </div>
                    </div>
                    
                    <!-- GHG Scope Inclusion -->
                    <div class="space-y-1.5">
                        <h3 class="font-bold text-base md:text-lg text-gray-700 border-b pb-1">3. GHG Scope Inclusion</h3>
                        
                        <div class="bg-control-bg p-3 rounded-lg shadow-sm">
                            <label for="scope3_inclusion" class="block font-semibold text-base text-scope3-color mb-1">
                                Scope 3 Reporting Inclusion (<span id="scope3_inclusion-value">50%</span>)
                                <span class="tooltip-container">
                                    <span class="tooltip-icon" title="?">?</span>
                                    <span class="tooltip-text">
                                        Scope 3 has 15 categories.<br>
                                        – 30%: ~4–5 major ones (e.g., business travel, upstream transport)<br>
                                        – 70%: ~10–11 key categories<br>
                                        – 100%: All 15 (incl. waste, investments, franchises, use-of-sold-products).
                                    </span>
                                </span>
                            </label>
                            <input type="range" id="scope3_inclusion" min="0" max="100" value="50" step="1" class="control-slider" style="--slider-thumb-color: #10B981;">
                        </div>

                        <div class="bg-control-bg p-3 rounded-lg shadow-sm">
                            <label for="scope1_inclusion" class="block font-semibold text-base text-scope1-color mb-1">
                                Scope 1 Inclusion (Completeness)
                                <span class="tooltip-container">
                                    <span class="tooltip-icon" title="?">?</span>
                                    <span class="tooltip-text">
                                        – Low (≤40%): Only largest source (e.g., main boiler)<br>
                                        – Medium (40–90%): Major sources covered (e.g., fleet + boiler)<br>
                                        – High (>90%): All direct sources (boiler, fleet, fugitive, small equipment).
                                    </span>
                                </span>
                            </label>
                            <input type="range" id="scope1_inclusion" min="0" max="100" value="100" step="1" class="control-slider" style="--slider-thumb-color: #EF4444;">
                        </div>

                        <div id="scope-explanation" class="bg-green-100 border-l-4 border-scope3-color p-2 text-xs text-green-700 rounded-lg">
                            <h4 class="font-bold inline-block mr-1">Current Report:</h4> Scope 1 is High; Scope 3 is 50%.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Results & Charts Panel -->
            <div class="lg:col-span-2 flex flex-col space-y-3 md:space-y-4">
                
                <!-- Top Row: Footprint & Gap Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                    <div class="bg-white p-3 rounded-xl shadow-lg border-l-4 border-scope3-color flex justify-between items-center">
                        <div class="space-y-0.5">
                            <p class="text-base md:text-xl font-medium text-gray-600">
                                Total Reported Footprint
                            </p>
                            <p class="text-xs text-gray-400 hidden md:block">
                                The number published in the annual report.
                            </p>
                        </div>
                        <div class="text-right">
                            <span id="final-result" class="text-2xl md:text-4xl font-extrabold text-primary-dark text-shadow">
                                13,420
                            </span>
                            <span id="result-unit" class="text-base md:text-xl font-semibold text-scope3-color block">
                                t CO₂e
                            </span>
                            <span id="uncertainty-badge" class="uncertainty-badge">±860 t</span>
                        </div>
                    </div>
                    
                    <div class="bg-white p-3 rounded-xl shadow-lg border-l-4 border-missed-red flex justify-between items-center">
                        <div class="space-y-1">
                            <div class="flex items-center space-x-1.5">
                                <svg class="w-4 h-4 md:w-5 md:h-5 text-missed-red" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/></svg>
                                <p class="text-sm md:text-lg font-medium text-missed-red">
                                    Missing Emissions (Unmeasured)
                                </p>
                            </div>
                            <div class="flex items-center space-x-1.5">
                                <svg class="w-4 h-4 md:w-5 md:h-5 text-counted-green" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/></svg>
                                <p class="text-sm md:text-lg font-medium text-counted-green">
                                    Reported Emissions
                                </p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span id="missed-emissions" class="text-lg md:text-2xl font-extrabold text-missed-red block">
                                10,580
                            </span>
                            <span id="true-counted" class="text-lg md:text-2xl font-extrabold text-counted-green block">
                                13,420
                            </span>
                        </div>
                    </div>
                </div>

                <!-- NEW: Detailed Gap Analysis Section -->
                <div class="bg-white p-3 md:p-4 rounded-xl shadow-lg border border-gray-200">
                    <h2 class="text-base md:text-lg font-bold mb-2 text-primary-dark">
                        What’s Included vs. What’s Missing
                    </h2>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-green-700">✅ Reported Emissions:</span>
                            <span id="detailed-counted" class="text-base md:text-lg font-semibold text-counted-green">
                                13,420 t CO₂e
                            </span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-red-700">❌ Missing (Unmeasured Emissions):</span>
                            <span id="detailed-missed" class="text-base md:text-lg font-semibold text-missed-red">
                                10,580 t CO₂e
                            </span>
                        </div>
                        <div class="pt-2 border-t border-gray-200">
                            <p class="text-xs md:text-sm text-gray-600">
                                <strong>These emissions are NOT counted because of your selected reporting choices:</strong>
                            </p>
                            <ul id="missed-breakdown" class="list-disc list-inside text-xs text-gray-700 ml-2 space-y-1">
                                <li>Fugitive emissions from AC/refrigeration units</li>
                                <li>Business air travel & employee commuting</li>
                                <li>Waste processing (landfill/incineration)</li>
                                <li>Downstream use of sold products (e.g., customer energy use)</li>
                                <li>Investments and financed emissions</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 flex-grow">
                    <!-- Scope Breakdown Chart -->
                    <div class="md:col-span-2 bg-white p-3 md:p-4 rounded-xl shadow-lg border border-gray-200 flex flex-col">
                        <h2 class="text-base md:text-lg font-bold mb-2 text-primary-dark">
                            Breakdown by Scope
                        </h2>
                        <div class="flex-grow min-h-0">
                            <canvas id="breakdownChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Accuracy & Simplicity -->
                    <div class="md:col-span-1 bg-white p-3 md:p-4 rounded-xl shadow-lg border border-gray-200 flex flex-col justify-between">
                        <h2 class="text-base md:text-lg font-bold mb-2 text-accuracy-color">
                            Tier Trade-Off Metrics
                        </h2>
                        <div class="space-y-3 flex-grow">
                            <div class="w-full">
                                <h3 class="text-xs md:text-sm font-medium text-accuracy-color">Accuracy (Low Uncertainty)</h3>
                                <div class="h-6 md:h-8"><canvas id="accuracyBarChart"></canvas></div>
                            </div>
                            <div class="w-full">
                                <h3 class="text-xs md:text-sm font-medium text-gray-600">Simplicity (Low Effort)</h3>
                                <div class="h-6 md:h-8"><canvas id="simplicityBarChart"></canvas></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let chartBreakdown, chartAccuracy, chartSimplicity;
        
        const industrySelector = document.getElementById('industry-selector');
        const industryDescription = document.getElementById('industry-description');
        const precisionInput = document.getElementById('precision');
        const scope3InclusionInput = document.getElementById('scope3_inclusion');
        const scope1InclusionInput = document.getElementById('scope1_inclusion');
        const finalResultSpan = document.getElementById('final-result');
        const resultUnitSpan = document.getElementById('result-unit');
        const uncertaintyBadge = document.getElementById('uncertainty-badge');
        const tierExplanationDiv = document.getElementById('tier-explanation');
        const scopeExplanationDiv = document.getElementById('scope-explanation');
        const missedEmissionsSpan = document.getElementById('missed-emissions');
        const trueCountedSpan = document.getElementById('true-counted');
        const detailedCountedSpan = document.getElementById('detailed-counted');
        const detailedMissedSpan = document.getElementById('detailed-missed');
        const missedBreakdownList = document.getElementById('missed-breakdown');

        const INDUSTRY_PROFILES = {
            'manufacturing': {
                name: 'Heavy Manufacturing',
                description: 'High Scope 2 (energy) and upstream Scope 3 (raw materials), typical of large-scale production.',
                scope1: 2000, scope2: 4000, scope3: 20000, unit: 't CO₂e'
            },
            'service': {
                name: 'Financial Services/Office',
                description: 'Dominated by Scope 3 (commuting, travel, procured services). Scope 1 and 2 are comparatively small.',
                scope1: 50, scope2: 800, scope3: 15000, unit: 't CO₂e'
            },
            'tech': {
                name: 'Software/Cloud Provider',
                description: 'HUGE Scope 2 footprint (data center electricity) and significant Scope 3 from hardware manufacturing.',
                scope1: 100, scope2: 15000, scope3: 8000, unit: 't CO₂e'
            },
            'construction': {
                name: 'High-Rise Construction',
                description: 'High Scope 1 (mobile machinery) and Scope 3 from procured materials (steel, cement).',
                scope1: 3000, scope2: 1000, scope3: 25000, unit: 't CO₂e'
            },
            'retail': {
                name: 'Food Retail/Grocery',
                description: 'High Scope 1 (refrigerant leaks, fleet) and massive downstream Scope 3 from customer purchased goods.',
                scope1: 1500, scope2: 2500, scope3: 35000, unit: 't CO₂e'
            }
        };

        // === IMPROVED: Realistic calculation logic ===
        function calculateReportedEmissions() {
            const industry = industrySelector.value;
            const TRUE_EMISSIONS = INDUSTRY_PROFILES[industry];
            const P = parseInt(precisionInput.value) / 100; // 0–1
            const S3 = parseInt(scope3InclusionInput.value) / 100; // 0–1
            const S1 = parseInt(scope1InclusionInput.value) / 100; // 0–1

            // ✅ FIXED: Linear inclusion (0% → 0, 100% → full)
            const scope1_reported = TRUE_EMISSIONS.scope1 * S1;
            const scope2_reported = TRUE_EMISSIONS.scope2; // Scope 2 = always 100% included (by definition)
            const scope3_reported = TRUE_EMISSIONS.scope3 * S3;

            const totalReported = scope1_reported + scope2_reported + scope3_reported;

            // Tier affects UNCERTAINTY, not central value
            // Tier 1: ±20%, Tier 2: ±10%, Tier 3: ±5%
            const uncertaintyPercent = 0.2 - 0.15 * P; // [0.2 → 0.05]
            const uncertaintyValue = totalReported * uncertaintyPercent;

            return {
                scope1: scope1_reported,
                scope2: scope2_reported,
                scope3: scope3_reported,
                total: totalReported,
                uncertainty: uncertaintyValue,
                unit: TRUE_EMISSIONS.unit,
                precision: P
            };
        }

        function calculateEmissionsGap() {
            const industry = industrySelector.value;
            const TRUE_EMISSIONS = INDUSTRY_PROFILES[industry];
            const S3 = parseInt(scope3InclusionInput.value) / 100;
            const S1 = parseInt(scope1InclusionInput.value) / 100;

            const reported = calculateReportedEmissions();
            const true_total = TRUE_EMISSIONS.scope1 + TRUE_EMISSIONS.scope2 + TRUE_EMISSIONS.scope3;

            // ✅ MISSING = Unmeasured emissions (completeness gap only)
            const s1_missing = TRUE_EMISSIONS.scope1 * (1 - S1);
            const s3_missing = TRUE_EMISSIONS.scope3 * (1 - S3);
            const missing_total = s1_missing + s3_missing;

            // ✅ Generate concrete examples of what’s missing
            const missingItems = [];
            // Scope 1 missing examples
            if (S1 < 0.95) missingItems.push("Fugitive emissions from AC/refrigeration units");
            if (S1 < 0.8) missingItems.push("Small fleet vehicles or on-site machinery");
            if (S1 < 0.6) missingItems.push("On-site incineration or backup generators");

            // Scope 3 missing examples (based on %)
            if (S3 < 0.9) missingItems.push("Business air travel & employee commuting");
            if (S3 < 0.7) missingItems.push("Waste processing (landfill/incineration)");
            if (S3 < 0.5) missingItems.push("Downstream use of sold products (e.g., customer energy use)");
            if (S3 < 0.3) missingItems.push("Investments and financed emissions");

            return {
                missing: missing_total,
                reported: reported.total,
                trueTotal: true_total,
                s1Missing: s1_missing,
                s3Missing: s3_missing,
                missingItems: missingItems
            };
        }

        function updateTierExplanation(P) {
            const tier = P < 33 ? 1 : (P < 67 ? 2 : 3);
            let text;
            if (tier === 1) {
                text = "Uses <strong>global IPCC default factors</strong>. Highest uncertainty (±20%).";
            } else if (tier === 2) {
                text = "Uses <strong>national/regional emission factors</strong>. Medium uncertainty (±10%).";
            } else {
                text = "Uses <strong>site- or supplier-specific measurements</strong>. Lowest uncertainty (±5%).";
            }
            tierExplanationDiv.innerHTML = `<h4 class="font-bold inline-block mr-1">Tier ${tier}:</h4> ${text}`;
        }

        function updateScopeExplanation(industry, P, S3, S1) {
            const S3_norm = S3 / 100;
            const scope1Level = S1 > 90 ? 'High' : (S1 > 40 ? 'Medium' : 'Low');
            
            let scope1Desc = "";
            if (scope1Level === 'High') scope1Desc = "All direct sources: boilers, fleet, fugitive, small equipment.";
            else if (scope1Level === 'Medium') scope1Desc = "Major sources (e.g., main boiler + company vehicles), but may miss fugitive leaks.";
            else scope1Desc = "Only the largest single source (e.g., main factory boiler).";

            let scope3Desc = "";
            if (S3 >= 90) scope3Desc = "All 15 Scope 3 categories, including waste, investments, and use-of-product.";
            else if (S3 >= 70) scope3Desc = "10–11 key categories: upstream materials, business travel, downstream transport.";
            else if (S3 >= 50) scope3Desc = "5–7 categories: e.g., upstream transport, business travel, some purchased goods.";
            else scope3Desc = "Few categories (e.g., only business flights or top supplier emissions).";

            scopeExplanationDiv.innerHTML = `
                <h4 class="font-bold inline-block mr-1">Current Report:</h4>
                Scope 1 is <strong>${scope1Level}</strong> (${scope1Desc}).<br>
                Scope 3 is <strong>${S3}%</strong> (${scope3Desc}).
            `;
        }

        function updateSimulation() {
            const results = calculateReportedEmissions();
            const gapResults = calculateEmissionsGap();
            
            const P = parseInt(precisionInput.value);
            const S3 = parseInt(scope3InclusionInput.value);
            const S1 = parseInt(scope1InclusionInput.value);
            const industry = industrySelector.value;
            const TRUE_EMISSIONS = INDUSTRY_PROFILES[industry];

            // Update UI
            industryDescription.textContent = TRUE_EMISSIONS.description;
            document.getElementById('scope3_inclusion-value').textContent = `${S3}%`;
            
            updateTierExplanation(P);
            updateScopeExplanation(industry, P, S3, S1);

            finalResultSpan.textContent = Math.round(results.total).toLocaleString('en-US');
            resultUnitSpan.textContent = results.unit;
            uncertaintyBadge.textContent = `±${Math.round(results.uncertainty).toLocaleString('en-US')} t`;

            missedEmissionsSpan.textContent = Math.round(gapResults.missing).toLocaleString('en-US');
            trueCountedSpan.textContent = Math.round(gapResults.reported).toLocaleString('en-US');

            detailedCountedSpan.textContent = `${Math.round(gapResults.reported).toLocaleString('en-US')} ${TRUE_EMISSIONS.unit}`;
            detailedMissedSpan.textContent = `${Math.round(gapResults.missing).toLocaleString('en-US')} ${TRUE_EMISSIONS.unit}`;

            // ✅ Populate real-world missing items
            missedBreakdownList.innerHTML = gapResults.missingItems.length > 0 
                ? gapResults.missingItems.map(item => `<li>${item}</li>`).join('')
                : '<li class="text-green-600">✅ All emissions are reported!</li>';

            // Update charts
            chartBreakdown.data.datasets[0].data = [results.scope1, results.scope2, results.scope3];
            chartBreakdown.options.scales.y.max = Math.max(results.total * 1.2, 1000);
            chartBreakdown.update('none');

            const accuracy = results.precision * 100;
            chartAccuracy.data.datasets[0].data = [accuracy];
            chartSimplicity.data.datasets[0].data = [100 - accuracy];
            chartAccuracy.update('none');
            chartSimplicity.update('none');
        }

        function init() {
            const initialResults = calculateReportedEmissions();

            // Scope Breakdown Chart
            const ctxBreakdown = document.getElementById('breakdownChart').getContext('2d');
            chartBreakdown = new Chart(ctxBreakdown, {
                type: 'bar',
                data: {
                    labels: ['Scope 1 (Direct)', 'Scope 2 (Energy)', 'Scope 3 (Value Chain)'],
                    datasets: [{
                        label: 'Reported Emissions',
                        data: [initialResults.scope1, initialResults.scope2, initialResults.scope3],
                        backgroundColor: ['#EF4444', '#F59E0B', '#10B981'],
                        borderColor: 'white',
                        borderWidth: 1,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: { display: true, text: 'Reported Tonnes CO₂e' },
                            beginAtZero: true,
                            max: Math.max(initialResults.total * 1.2, 1000)
                        },
                        x: { grid: { display: false } }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // Accuracy Chart
            const ctxAccuracy = document.getElementById('accuracyBarChart').getContext('2d');
            chartAccuracy = new Chart(ctxAccuracy, {
                type: 'bar',
                data: {
                    labels: [''],
                    datasets: [{ data: [initialResults.precision * 100], backgroundColor: '#4C51BF' }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    scales: { x: { max: 100, min: 0, ticks: { display: false }, grid: { display: false } }, y: { display: false } },
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    layout: { padding: { top: 2, bottom: 2 } }
                }
            });

            // Simplicity Chart
            const ctxSimplicity = document.getElementById('simplicityBarChart').getContext('2d');
            chartSimplicity = new Chart(ctxSimplicity, {
                type: 'bar',
                data: {
                    labels: [''],
                    datasets: [{ data: [100 - initialResults.precision * 100], backgroundColor: '#D1D5DB' }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    scales: { x: { max: 100, min: 0, ticks: { display: false }, grid: { display: false } }, y: { display: false } },
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    layout: { padding: { top: 2, bottom: 2 } }
                }
            });

            // Events
            industrySelector.addEventListener('change', updateSimulation);
            [precisionInput, scope3InclusionInput, scope1InclusionInput].forEach(input => {
                input.addEventListener('input', updateSimulation);
            });

            updateSimulation();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
